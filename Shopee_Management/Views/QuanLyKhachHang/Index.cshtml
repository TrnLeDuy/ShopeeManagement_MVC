@model PagedList.IPagedList<Shopee_Management.Models.KHACHHANG>
@using PagedList.Mvc;
@{
    ViewBag.Title = "Quản lý Khách hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .non-clickable {
        pointer-events: none;
        cursor: default;
    }

    .highlight {
        background-color: darkred !important;
    }

    .disable-text-select {
        -webkit-user-select: none; /* Safari */
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* IE10+/Edge */
        user-select: none;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

        .table th, .table td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        .table th {
            background-color: #ffcc00;
            color: #333;
        }

        .table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .table tr:nth-child(odd) {
            background-color: #f0f8ff;
        }



    .action-links a {
        margin-right: 5px;
        color: #0000ff;
    }

    p {
        margin-top: 20px;
        color: #555;
    }

    h2 {
        font-size: 24px;
        margin-bottom: 20px;
        color: #ee4d2d;
    }

    .btn {
        min-width: 70px;
        height: 34px;
        text-decoration: none;
        border: none;
        border-radius: 2px;
        font-size: 1.2rem;
        padding: 0 12px;
        outline: none;
        cursor: pointer;
        color: #fff !important;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        line-height: 1.6rem;
    }

        .btn.btn--add {
            color: #fff;
            background-color: #0ab618;
        }

        .btn.btn--edit {
            color: #fff;
            background-color: #ffce3e;
        }

        .btn.btn--delete {
            color: #fff;
            background-color: #e72311;
        }

    .btn-form__controls-mr {
        margin-right: 8px;
    }

    /* Thêm các kiểu dáng tùy chỉnh cho thanh phân trang */
    .pagination-container {
        margin-top: 20px;
        text-align: center;
    }

    .pagination {
        display: inline-block;
        padding-left: 0;
        margin: 20px 0;
        border-radius: 4px;
    }

        .pagination > li {
            display: inline;
        }

            .pagination > li > a,
            .pagination > li > span {
                position: relative;
                float: left;
                padding: 6px 12px;
                margin-left: -1px;
                line-height: 1.428571429;
                text-decoration: none;
                background-color: #fff;
                border: 1px solid #ddd;
            }

            .pagination > li:first-child > a,
            .pagination > li:first-child > span {
                margin-left: 0;
                border-bottom-left-radius: 4px;
                border-top-left-radius: 4px;
            }

            .pagination > li:last-child > a,
            .pagination > li:last-child > span {
                border-bottom-right-radius: 4px;
                border-top-right-radius: 4px;
            }

            .pagination > li > a:hover,
            .pagination > li > span:hover,
            .pagination > li > a:focus,
            .pagination > li > span:focus {
                z-index: 2;
                color: #23527c;
                background-color: #eee;
                border-color: #ddd;
            }

    .navbar {
        background-color: #333;
        overflow: hidden;
        display: block;
    }

        .navbar td {
            float: left;
            color: #f2f2f2;
            text-align: center;
            padding-left: 14px;
            padding-right: 14px;
            text-decoration: none;
        }

            .navbar td:hover {
                background-color: #ddd;
                color: black;
            }

    .modal-dialog {
        margin-top: 100px;
    }
</style>

<h2>Quản lý Khách hàng</h2>

<table class="navbar disable-text-select">
    <tr>
        <td id="TOOLBAR_khachhang_detail"><i class="fa fa-eye"></i> Xem chi tiết</td>
        <td id="TOOLBAR_khachhang_edit"><i class="fa fa-edit"></i> Chỉnh sửa</td>
        <td id="export-icon"><i class="fa fa-file-excel"></i> Xuất Excel
            <script>
                $("#export-icon").click(function () {
                    window.location.href = "@Url.Action("ExportToExcel", "QuanLyKhachHang")";
                });
            </script>
        </td>
    </tr>
</table>



<table id="TABLE_khachhang" class="table disable-text-select">
    <thead>
        <tr>
            <th></th>
            <th>
                Mã Khách Hàng
            </th>
            <th>
                Họ và tên
            </th>
            <th>
                Số điện thoại
            </th>
            <th>
                Địa chỉ
            </th>
            <th>
                Tình trạng
            </th>
            <th>
                Điểm tích lũy
            </th>
        </tr>
    </thead>

    @{ int counter = 0;}

    <tbody id="BODY_khachhang" class="data">
        @foreach (var item in Model)
        {
            <tr data-id="@item.id_kh" onclick="highlightRow('@item.id_kh')">
                <td class="non-clickable" style="text-align: center;">
                    @{ counter++;}
                    @counter
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.id_kh)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ho_ten)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.sdt)
                </td>
                <td>

                    @Html.DisplayFor(modelItem => item.dia_chi)
                </td>
                @{
                    if (item.tinh_trang_kh == 0)
                    {
                        <td> Đã khóa </td>
                    }
                    if (item.tinh_trang_kh == 1)
                    {
                        <td>Đang hoạt động</td>
                    }
                }
                <td>
                    @Html.DisplayFor(modelItem => item.diem_tich_luy)
                </td>
            </tr>
        }
    </tbody>

</table>

<div class="modal" id="editModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-lg ui-draggable" role="document">
        <div class="modal-content">
            <div class="modal-header ui-draggable-handle">
                <button type="button" btnid="cancel" class="close btn-close-form" data-dismiss="modal" aria-label="Close">
                    <span class="icon-close-form">✖</span>
                </button>
            </div>
            <div class="modal-body" style="min-height: 0px;">
                <h2 class="text-title-form" style="text-align: center">Cập nhật quyền truy cập người dùng</h2>
                <div id="editPartialContainer">
                    @Html.Partial("ChinhSuaTrangThai", new Shopee_Management.Models.KHACHHANG())
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="detailModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-lg ui-draggable" role="document">
        <div class="modal-content">
            <div class="modal-header ui-draggable-handle">
                <button type="button" btnid="cancel" class="close btn-close-form" data-dismiss="modal" aria-label="Close">
                    <span class="icon-close-form">✖</span>
                </button>
            </div>
            <div class="modal-body" style="min-height: 0px;">
                <h2 class="text-title-form" style="text-align: center">Thông tin chi tiết Khách hàng</h2>
                <div id="detailPartialContainer">
                    @Html.Partial("ChiTiet", new Shopee_Management.Models.KHACHHANG())
                </div>
            </div>
        </div>
    </div>
</div>


<div class="pagination-container">
    @Html.PagedListPager(Model, page => Url.Action("Index", new { page }))
</div>

<script>
    var selectedId = null;


    $(document).ready(function () {
        $('tr').on('click', function () {
            // Store the selected ID
            selectedId = $(this).data('id');

        });

        $('#TOOLBAR_khachhang_edit').on('click', function () {
            if (selectedId) {
                //redirectToEdit(selectedId);
                openEditModal(selectedId);
            } else {
                // Handle the case when no row is selected
                alert('Hãy chọn dữ liệu.');
            }
        });

        $('#TOOLBAR_khachhang_detail').on('click', function () {
            if (selectedId) {
                //redirectToDetail(selectedId);
                openDetailModal(selectedId);
            } else {
                // Handle the case when no row is selected
                alert('Hãy chọn dữ liệu.');
            }
        });
    });
    $(document).ready(function () {
        $('#TABLE_khachhang td').on('click', function () {
            // Remove the old highlight from all cells
            $('#TABLE_khachhang td').removeClass('highlight');

            // Highlight the clicked cell
            $(this).addClass('highlight');

            // Store the selected ID
            selectedId = $(this).closest('tr').data('id');
        });

        // Remove the highlight when clicking outside of the table
        $(document).on('click', function (e) {
            if (!$(e.target).closest('#TABLE_khachhang').length) {
                $('#TABLE_khachhang td').removeClass('highlight');
                selectedId = null;
            }
        });
    });
    function openEditModal(id) {
    // Fetch data based on the ID using AJAX
        $.ajax({
            url: '@Url.Action("ChinhSuaTrangThai", "QuanLyKhachHang")', // Replace with the appropriate URL for fetching the Edit partial view
            data: { id: id },
            type: 'GET',
            success: function (result) {
                // Load the Edit partial view into the editPartialContainer
                $('#editPartialContainer').html(result);
            },
            error: function (error) {
                console.error('Error fetching data: ' + error);
            }
        });
    // Open the modal
    $('#editModal').css('display', 'block');
    }
    function openDetailModal(id) {
    // Fetch data based on the ID using AJAX
        $.ajax({
            url: '@Url.Action("ChiTiet", "QuanLyKhachHang")', // Replace with the appropriate URL for fetching the Edit partial view
            data: { id: id },
            type: 'GET',
            success: function (result) {
                // Load the Edit partial view into the editPartialContainer
                $('#detailPartialContainer').html(result);
            },
            error: function (error) {
                console.error('Error fetching data: ' + error);
            }
        });
    // Open the modal
    $('#detailModal').css('display', 'block');
    }
</script>